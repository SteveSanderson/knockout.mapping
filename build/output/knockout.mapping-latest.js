// Knockout Mapping plugin v1.2.1
// (c) 2011 Steven Sanderson, Roy Jacobs - http://knockoutjs.com/
// License: Ms-Pl (http://www.opensource.org/licenses/ms-pl.html)

ko.exportSymbol=function(l,q){for(var j=l.split("."),h=window,k=0;k<j.length-1;k++)h=h[j[k]];h[j[j.length-1]]=q};ko.exportProperty=function(l,q,j){l[q]=j};
(function(){function l(a,b){for(var c in b)b.hasOwnProperty(c)&&b[c]&&(a[c]&&!(a[c]instanceof Array)?l(a[c],b[c]):a[c]=b[c])}function q(a,b){var c={};l(c,a);l(c,b);return c}function j(a){if(a&&typeof a==="object"&&a.constructor==(new Date).constructor)return"date";return typeof a}function h(a,b){a=a||{};if(a.create instanceof Function||a.key instanceof Function||a.arrayChanged instanceof Function)a={"":a};if(b)a.ignore=k(b.ignore,a.ignore),a.include=k(b.include,a.include),a.copy=k(b.copy,a.copy);
a.ignore=k(a.ignore,g.ignore);a.include=k(a.include,g.include);a.copy=k(a.copy,g.copy);a.mappedProperties={};return a}function k(a,b){a instanceof Array||(a=j(a)==="undefined"?[]:[a]);b instanceof Array||(b=j(b)==="undefined"?[]:[b]);return a.concat(b)}function A(a){var b=ko.dependentObservable;ko.dependentObservable=function(a,b,d){d=d||{};d.deferEvaluation=!0;a=new w(a,b,d);a.__ko_proto__=w;return a};a=a();ko.dependentObservable=b;return a}function s(a,b,c,e,d,k,t){var g=ko.utils.unwrapObservable(b)instanceof
Array,t=t||"";if(ko.mapping.isMapped(a))var i=ko.utils.unwrapObservable(a)[m],c=q(i,c);i=function(){return c[d]&&c[d].create instanceof Function};e=e||new B;if(e.get(b))return a;d=d||"";if(g){var g=[],f=function(a){return a};if(c[d]&&c[d].key)f=c[d].key;var l=function(a){return a};i()&&(l=function(a){return c[d].create({data:a,parent:k})});if(!ko.isObservable(a))a=ko.observableArray([]),a.mappedRemove=function(b){var c=typeof b=="function"?b:function(a){return a===f(b)};return a.remove(function(a){return c(f(a))})},
a.mappedRemoveAll=function(b){var c=u(b,f);return a.remove(function(a){return ko.utils.arrayIndexOf(c,f(a))!=-1})},a.mappedDestroy=function(b){var c=typeof b=="function"?b:function(a){return a===f(b)};return a.destroy(function(a){return c(f(a))})},a.mappedDestroyAll=function(b){var c=u(b,f);return a.destroy(function(a){return ko.utils.arrayIndexOf(c,f(a))!=-1})},a.mappedIndexOf=function(b){var c=u(a(),f),b=f(b);return ko.utils.arrayIndexOf(c,b)},a.mappedCreate=function(b){if(a.mappedIndexOf(b)!==
-1)throw Error("There already is an object with the key that you specified.");b=l(b);a.push(b);return b};for(var i=u(ko.utils.unwrapObservable(a),f).sort(),h=u(b,f).sort(),i=ko.utils.compareArrays(i,h),h={},o=[],x=0,w=i.length;x<w;x++){var r=i[x],p,n=t+"["+x+"]";switch(r.status){case "added":var v=y(ko.utils.unwrapObservable(b),r.value,f);p=ko.utils.unwrapObservable(s(void 0,v,c,e,d,a,n));n=C(ko.utils.unwrapObservable(b),v,h);o[n]=p;h[n]=!0;break;case "retained":v=y(ko.utils.unwrapObservable(b),r.value,
f);p=y(a,r.value,f);s(p,v,c,e,d,a,n);n=C(ko.utils.unwrapObservable(b),v,h);o[n]=p;h[n]=!0;break;case "deleted":p=y(a,r.value,f)}g.push({event:r.status,item:p})}a(o);c[d]&&c[d].arrayChanged&&ko.utils.arrayForEach(g,function(a){c[d].arrayChanged(a.event,a.item)})}else if(z(b)){if(!a)if(i())return A(function(){return c[d].create({data:b,parent:k})});else a={};e.save(b,a);D(b,function(d){var f=t.length?t+"."+d:d;if(ko.utils.arrayIndexOf(c.ignore,f)==-1)if(ko.utils.arrayIndexOf(c.copy,f)!=-1)a[d]=b[d];
else{var g=e.get(b[d]);a[d]=g?g:s(a[d],b[d],c,e,d,a,f);c.mappedProperties[f]=!0}})}else switch(j(b)){case "function":a=b;break;default:ko.isWriteableObservable(a)?a(ko.utils.unwrapObservable(b)):a=i()?A(function(){return c[d].create({data:b,parent:k})}):ko.observable(ko.utils.unwrapObservable(b))}return a}function C(a,b,c){for(var e=0,d=a.length;e<d;e++)if(c[e]!==!0&&a[e]==b)return e;return null}function E(a,b){var c;b&&(c=b(a));j(c)==="undefined"&&(c=a);return ko.utils.unwrapObservable(c)}function y(a,
b,c){a=ko.utils.arrayFilter(ko.utils.unwrapObservable(a),function(a){return E(a,c)==b});if(a.length==0)throw Error("When calling ko.update*, the key '"+b+"' was not found!");if(a.length>1&&z(a[0]))throw Error("When calling ko.update*, the key '"+b+"' was not unique!");return a[0]}function u(a,b){return ko.utils.arrayMap(ko.utils.unwrapObservable(a),function(a){return b?E(a,b):a})}function D(a,b){if(a instanceof Array)for(var c=0;c<a.length;c++)b(c);else for(c in a)b(c)}function z(a){var b=j(a);return b==
"object"&&a!==null&&b!=="undefined"}function B(){var a=[],b=[];this.save=function(c,e){var d=ko.utils.arrayIndexOf(a,c);d>=0?b[d]=e:(a.push(c),b.push(e))};this.get=function(c){c=ko.utils.arrayIndexOf(a,c);return c>=0?b[c]:void 0}}ko.mapping={};var m="__ko_mapping__",w=ko.dependentObservable,o={include:["_destroy"],ignore:[],copy:[]},g=o;ko.mapping.fromJS=function(a,b,c){if(arguments.length==0)throw Error("When calling ko.fromJS, pass the object you want to convert.");var b=h(b),e=s(c,a,b);e[m]=q(e[m],
b);return e};ko.mapping.fromJSON=function(a,b){var c=ko.utils.parseJson(a);return ko.mapping.fromJS(c,b)};ko.mapping.isMapped=function(a){return(a=ko.utils.unwrapObservable(a))&&a[m]};ko.mapping.updateFromJS=function(a,b){if(arguments.length<2)throw Error("When calling ko.updateFromJS, pass: the object to update and the object you want to update from.");if(!a)throw Error("The object is undefined.");if(!a[m])throw Error("The object you are trying to update was not created by a 'fromJS' or 'fromJSON' mapping.");
return s(a,b,a[m])};ko.mapping.updateFromJSON=function(a,b,c){b=ko.utils.parseJson(b);return ko.mapping.updateFromJS(a,b,c)};ko.mapping.toJS=function(a,b){g||ko.mapping.resetDefaultOptions();if(arguments.length==0)throw Error("When calling ko.mapping.toJS, pass the object you want to convert.");if(!(g.ignore instanceof Array))throw Error("ko.mapping.defaultOptions().ignore should be an array.");if(!(g.include instanceof Array))throw Error("ko.mapping.defaultOptions().include should be an array.");
if(!(g.copy instanceof Array))throw Error("ko.mapping.defaultOptions().copy should be an array.");b=h(b,a[m]);return ko.mapping.visitModel(a,function(a){return ko.utils.unwrapObservable(a)},b)};ko.mapping.toJSON=function(a,b){var c=ko.mapping.toJS(a,b);return ko.utils.stringifyJson(c)};ko.mapping.defaultOptions=function(){if(arguments.length>0)g=arguments[0];else return g};ko.mapping.resetDefaultOptions=function(){g={include:o.include.slice(0),ignore:o.ignore.slice(0),copy:o.copy.slice(0)}};ko.mapping.visitModel=
function(a,b,c){c=c||{};c.visitedObjects=c.visitedObjects||new B;c.parentName||(c=h(c));var e,d=ko.utils.unwrapObservable(a);if(z(d))b(a,c.parentName),e=d instanceof Array?[]:{};else return b(a,c.parentName);c.visitedObjects.save(a,e);var g=c.parentName;D(d,function(a){if(!(c.ignore&&ko.utils.arrayIndexOf(c.ignore,a)!=-1)){var h=d[a],i=c,f=g||"";d instanceof Array?g&&(f+="["+a+"]"):(g&&(f+="."),f+=a);i.parentName=f;if(!(ko.utils.arrayIndexOf(c.copy,a)===-1&&ko.utils.arrayIndexOf(c.include,a)===-1&&
d[m]&&d[m].mappedProperties&&!d[m].mappedProperties[a]&&!(d instanceof Array)))switch(j(ko.utils.unwrapObservable(h))){case "object":case "undefined":i=c.visitedObjects.get(h);e[a]=j(i)!=="undefined"?i:ko.mapping.visitModel(h,b,c);break;default:e[a]=b(h,c.parentName)}}});return e};ko.exportSymbol("ko.mapping",ko.mapping);ko.exportSymbol("ko.mapping.fromJS",ko.mapping.fromJS);ko.exportSymbol("ko.mapping.fromJSON",ko.mapping.fromJSON);ko.exportSymbol("ko.mapping.isMapped",ko.mapping.isMapped);ko.exportSymbol("ko.mapping.defaultOptions",
ko.mapping.defaultOptions);ko.exportSymbol("ko.mapping.toJS",ko.mapping.toJS);ko.exportSymbol("ko.mapping.toJSON",ko.mapping.toJSON);ko.exportSymbol("ko.mapping.updateFromJS",ko.mapping.updateFromJS);ko.exportSymbol("ko.mapping.updateFromJSON",ko.mapping.updateFromJSON);ko.exportSymbol("ko.mapping.visitModel",ko.mapping.visitModel)})();
