// Knockout Mapping plugin v2.0.4
// (c) 2011 Steven Sanderson, Roy Jacobs - http://knockoutjs.com/
// License: MIT (http://www.opensource.org/licenses/mit-license.php)

(function(d){"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?d(require("knockout"),exports):"function"===typeof define&&define.amd?define(["knockout","exports"],d):d(ko,ko.mapping={})})(function(d,f){function C(a,c){for(var b in c)c.hasOwnProperty(b)&&c[b]&&(b&&a[b]&&!(a[b]instanceof Array)?C(a[b],c[b]):a[b]=c[b])}function D(a,c){var b={};C(b,a);C(b,c);return b}function o(a,c){a=a||{};if(a.create instanceof Function||a.update instanceof Function||a.key instanceof Function||
a.arrayChanged instanceof Function)a={"":a};c&&(a.ignore=l(c.ignore,a.ignore),a.include=l(c.include,a.include),a.copy=l(c.copy,a.copy));a.ignore=l(a.ignore,g.ignore);a.include=l(a.include,g.include);a.copy=l(a.copy,g.copy);a.mappedProperties=a.mappedProperties||{};return a}function l(a,c){a instanceof Array||(a="undefined"===f.getType(a)?[]:[a]);c instanceof Array||(c="undefined"===f.getType(c)?[]:[c]);return a.concat(c)}function M(a,c){var b=d.dependentObservable;d.dependentObservable=function(b,
c,e){var e=e||{},f=e.deferEvaluation;b&&"object"==typeof b&&(e=b);var j=!1,m=function(b){var c=q({read:function(){j||(d.utils.arrayRemoveItem(a,b),j=!0);return b.apply(b,arguments)},write:function(a){return b(a)},deferEvaluation:!0});c.__ko_proto__=q;return c};e.deferEvaluation=!0;b=new q(b,c,e);b.__ko_proto__=q;f||(a.push(b),b=m(b));return b};d.computed=d.dependentObservable;var e=c();d.dependentObservable=b;d.computed=d.dependentObservable;return e}function y(a,c,b,e,H,g){var x=d.utils.unwrapObservable(c)instanceof
Array,g=g||"";if(f.isMapped(a))var h=d.utils.unwrapObservable(a)[m],b=D(h,b);var j=function(){return b[e]&&b[e].create instanceof Function},l=function(a){return M(E,function(){return b[e].create({data:a||c,parent:H})})},k=function(){return b[e]&&b[e].update instanceof Function},r=function(a,f){var h={data:f||c,parent:H,target:d.utils.unwrapObservable(a)};d.isWriteableObservable(a)&&(h.observable=a);return b[e].update(h)};if(h=z.get(c))return h;e=e||"";if(x){var x=[],n=!1,i=function(a){return a};b[e]&&
b[e].key&&(i=b[e].key,n=!0);d.isObservable(a)||(a=d.observableArray([]),a.mappedRemove=function(b){var c="function"==typeof b?b:function(a){return a===i(b)};return a.remove(function(a){return c(i(a))})},a.mappedRemoveAll=function(b){var c=v(b,i);return a.remove(function(a){return-1!=d.utils.arrayIndexOf(c,i(a))})},a.mappedDestroy=function(b){var c="function"==typeof b?b:function(a){return a===i(b)};return a.destroy(function(a){return c(i(a))})},a.mappedDestroyAll=function(b){var c=v(b,i);return a.destroy(function(a){return-1!=
d.utils.arrayIndexOf(c,i(a))})},a.mappedIndexOf=function(b){var c=v(a(),i),b=i(b);return d.utils.arrayIndexOf(c,b)},a.mappedCreate=function(b){if(-1!==a.mappedIndexOf(b))throw Error("There already is an object with the key that you specified.");var c=j()?l(b):b;k()&&(b=r(c,b),d.isWriteableObservable(c)?c(b):c=b);a.push(c);return c});var h=v(d.utils.unwrapObservable(a),i).sort(),t=v(c,i);n&&t.sort();for(var n=d.utils.compareArrays(h,t),h={},t=[],o=0,q=n.length;o<q;o++){var u=n[o],p,s=g+"["+o+"]";switch(u.status){case "added":var w=
A(d.utils.unwrapObservable(c),u.value,i);p=y(void 0,w,b,e,a,s);j()||(p=d.utils.unwrapObservable(p));s=I(d.utils.unwrapObservable(c),w,h);t[s]=p;h[s]=!0;break;case "retained":w=A(d.utils.unwrapObservable(c),u.value,i);p=A(a,u.value,i);y(p,w,b,e,a,s);s=I(d.utils.unwrapObservable(c),w,h);t[s]=p;h[s]=!0;break;case "deleted":p=A(a,u.value,i)}x.push({event:u.status,item:p})}a(t);b[e]&&b[e].arrayChanged&&d.utils.arrayForEach(x,function(a){b[e].arrayChanged(a.event,a.item)})}else if(F(c)){a=d.utils.unwrapObservable(a);
if(!a){if(j())return n=l(),k()&&(n=r(n)),n;if(k())return r(n);a={}}k()&&(a=r(a));z.save(c,a);J(c,function(e){var f=g.length?g+"."+e:e;if(-1==d.utils.arrayIndexOf(b.ignore,f))if(-1!=d.utils.arrayIndexOf(b.copy,f))a[e]=c[e];else{var h=z.get(c[e])||y(a[e],c[e],b,e,a,f);if(d.isWriteableObservable(a[e]))a[e](d.utils.unwrapObservable(h));else a[e]=h;b.mappedProperties[f]=!0}})}else switch(f.getType(c)){case "function":k()?d.isWriteableObservable(c)?(c(r(c)),a=c):a=r(c):a=c;break;default:d.isWriteableObservable(a)?
k()?a(r(a)):a(d.utils.unwrapObservable(c)):(a=j()?l():d.observable(d.utils.unwrapObservable(c)),k()&&a(r(a)))}return a}function I(a,c,b){for(var e=0,d=a.length;e<d;e++)if(!0!==b[e]&&a[e]===c)return e;return null}function K(a,c){var b;c&&(b=c(a));"undefined"===f.getType(b)&&(b=a);return d.utils.unwrapObservable(b)}function A(a,c,b){a=d.utils.arrayFilter(d.utils.unwrapObservable(a),function(a){return K(a,b)===c});if(0==a.length)throw Error("When calling ko.update*, the key '"+c+"' was not found!");
if(1<a.length&&F(a[0]))throw Error("When calling ko.update*, the key '"+c+"' was not unique!");return a[0]}function v(a,c){return d.utils.arrayMap(d.utils.unwrapObservable(a),function(a){return c?K(a,c):a})}function J(a,c){if(a instanceof Array)for(var b=0;b<a.length;b++)c(b);else for(b in a)c(b)}function F(a){var c=f.getType(a);return"object"===c&&null!==a&&"undefined"!==c}function L(){var a=[],c=[];this.save=function(b,e){var f=d.utils.arrayIndexOf(a,b);0<=f?c[f]=e:(a.push(b),c.push(e))};this.get=
function(b){b=d.utils.arrayIndexOf(a,b);return 0<=b?c[b]:void 0}}var m="__ko_mapping__",q=d.dependentObservable,G=0,E,z,B={include:["_destroy"],ignore:[],copy:[]},g=B;f.isMapped=function(a){return(a=d.utils.unwrapObservable(a))&&a[m]};f.fromJS=function(a){if(0==arguments.length)throw Error("When calling ko.fromJS, pass the object you want to convert.");window.setTimeout(function(){G=0},0);G++||(E=[],z=new L);var c,b;2==arguments.length&&(arguments[1][m]?b=arguments[1]:c=arguments[1]);3==arguments.length&&
(c=arguments[1],b=arguments[2]);b&&(c=D(c,b[m]));c=o(c);var e=y(b,a,c);b&&(e=b);--G||window.setTimeout(function(){d.utils.arrayForEach(E,function(a){a&&a()})},0);e[m]=D(e[m],c);return e};f.fromJSON=function(a){var c=d.utils.parseJson(a);arguments[0]=c;return f.fromJS.apply(this,arguments)};f.updateFromJS=function(){throw Error("ko.mapping.updateFromJS, use ko.mapping.fromJS instead. Please note that the order of parameters is different!");};f.updateFromJSON=function(){throw Error("ko.mapping.updateFromJSON, use ko.mapping.fromJSON instead. Please note that the order of parameters is different!");
};f.toJS=function(a,c){g||f.resetDefaultOptions();if(0==arguments.length)throw Error("When calling ko.mapping.toJS, pass the object you want to convert.");if(!(g.ignore instanceof Array))throw Error("ko.mapping.defaultOptions().ignore should be an array.");if(!(g.include instanceof Array))throw Error("ko.mapping.defaultOptions().include should be an array.");if(!(g.copy instanceof Array))throw Error("ko.mapping.defaultOptions().copy should be an array.");c=o(c,a[m]);return f.visitModel(a,function(a){return d.utils.unwrapObservable(a)},
c)};f.toJSON=function(a,c){var b=f.toJS(a,c);return d.utils.stringifyJson(b)};f.defaultOptions=function(){if(0<arguments.length)g=arguments[0];else return g};f.resetDefaultOptions=function(){g={include:B.include.slice(0),ignore:B.ignore.slice(0),copy:B.copy.slice(0)}};f.getType=function(a){return a&&"object"===typeof a&&a.constructor==(new Date).constructor?"date":typeof a};f.visitModel=function(a,c,b){b=b||{};b.visitedObjects=b.visitedObjects||new L;b.parentName||(b=o(b));var e,g=d.utils.unwrapObservable(a);
if(F(g))c(a,b.parentName),e=g instanceof Array?[]:{};else return c(a,b.parentName);b.visitedObjects.save(a,e);var l=b.parentName;J(g,function(a){var h=b,j=g[m];j&&(h=o(j,b));if(!(h.ignore&&-1!=d.utils.arrayIndexOf(h.ignore,a))){var j=g[a],q=b,k=l||"";g instanceof Array?l&&(k+="["+a+"]"):(l&&(k+="."),k+=a);q.parentName=k;if(!(-1===d.utils.arrayIndexOf(h.copy,a)&&-1===d.utils.arrayIndexOf(h.include,a)&&g[m]&&g[m].mappedProperties&&!g[m].mappedProperties[a]&&!(g instanceof Array)))switch(f.getType(d.utils.unwrapObservable(j))){case "object":case "undefined":h=
b.visitedObjects.get(j);e[a]="undefined"!==f.getType(h)?h:f.visitModel(j,c,b);break;default:e[a]=c(j,b.parentName)}}});return e}});
